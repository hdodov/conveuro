!function(){"use strict";function a(a){for(var e=[a.selectedText,a.startContainerText,a.endContainerText,a.commonAncestorText],s=null,o=null,l=0;l<e.length;l++)"string"==typeof e[l]&&"number"!=typeof o&&(o=r(e[l]));if("number"==typeof o)for(l=0;l<e.length;l++)"string"==typeof e[l]&&"string"!=typeof s&&(s=n(e[l]));return{currency:s,value:o}}function r(a){var r,n,e=/(\d(?:[\.,\s]?\d+)*)(?:([a-z])\b)?/i.exec(a);return e&&e.length&&(r=m(e[1]),(n=e[2])?c.modifierSymbols.forEach(function(a){n.match(a[0])&&(r*=a[1])}):c.modifierWords.forEach(function(n){a.match(n[0])&&(r*=n[1])})),"number"==typeof r&&NaN!==r?r:null}function n(a){var r=f(function(r,n){return-1!==a.indexOf(n)});if(1===o(r))for(var n in r)return n;var e=f(function(r){var n=0;return r.symbols.forEach(function(r){("string"==typeof r&&-1!==a.indexOf(r)||"object"==typeof r&&r instanceof RegExp&&a.match(r))&&n++}),n>0&&n}),s=f(function(r){var n=0;return r.words.forEach(function(r){a.match(new RegExp(r,"i"))&&n++}),n>0&&n});e=t(e),s=t(s);var l=Object.keys(i(e,s));return(l=l.sort(function(a,r){return y[a]&&y[r]?y[r].share-y[a].share:0})).length>0?l[0]:null}function e(){var a=new XMLHttpRequest;return new Promise(function(r,n){a.addEventListener("readystatechange",function(){if(4===this.readyState){if(200==this.status){var a=null;try{a=JSON.parse(this.responseText)}catch(a){return n({message:"Couldn't parse response data."})}return a&&a.rates?(console.log("API response:",a),r(a)):n({message:"No rates data found in response."})}return n({message:this.statusText,status:this.status})}}),a.open("GET",c.apiUrl,!0),a.send(null)})}function s(){return new Promise(function(a,r){chrome.storage.sync.get("apiResponse",function(n){var s=n.apiResponse;if(s){var o=new Date(1e3*s.timestamp),l=new Date-o;if(l<1296e5)return console.log("Data cached for",parseInt((1296e5-l)/6e4),"minutes:",s),a(s)}e().then(function(r){chrome.storage.sync.set({apiResponse:r},function(n){console.log("Saved response in synced storage:",n),a(r)})}).catch(r)})})}function o(a){var r=0;for(var n in a)r++;return r}function l(a,r){var n={};for(var e in a)r(a[e],e)&&(n[e]=a[e]);return n}function t(a){var r;for(var n in a)(a[n]>r||void 0===r)&&(r=a[n]);return l(a,function(a){return a===r})}function i(){var a={};return[].forEach.call(arguments,function(r){if("object"==typeof r&&null!==r)for(var n in r)a[n]=r[n]}),a}function m(a){for(var r="",n=[],e=/\D+/gi,s=null,o=a.replace(e,"-").split("-");;){if(!(s=e.exec(a)))break;n.push(s[0])}for(var l=0;l<o.length;l++)l===o.length-1&&l>0&&(3!==o[l].length||"."===n[l-1])&&(r+="."),r+=o[l];return parseFloat(r)}function d(a,r){if("number"!=typeof a)return a;var n=a.toString().split("."),e=n[0],s=n[1]||"",o=u(e),l=r-e.length,t="";if(1==l&&(l=2),l>0)for(var i=0;i<l;i++)t+=void 0!==s[i]?s[i]:"0";var m=o;return t.length>0&&(m+="."+t),m}function u(a){if("string"==typeof a||"number"==typeof a){var r=parseInt(a);if("number"!=typeof r||0==r)return a}for(var n="",e=0,s=a.length-1;s>=0;s--)n=a[s]+n,++e>=3&&s>0&&(n=","+n,e=0);return n}function f(a){var r={};for(var n in y){var e=a(y[n],n);!1!==e&&(r[n]=e)}return r}function h(a,r,n){var e=r;return y[a]&&(e=(e=(e=y[a].format).replace(/\%d/g,r)).replace(/\%s/g,!1!==n?a:"")),"string"==typeof e?e.trim():r}var c={apiUrl:"http://data.fixer.io/api/latest?access_key=61bef622cdab2e0f536a8343bd33e43c",modifierSymbols:[[/k/i,1e3],[/m/i,1e6],[/b/i,1e9],[/t/i,1e12]],modifierWords:[[/thousand/i,1e3],[/million/i,1e6],[/billion/i,1e9],[/trillion/i,1e12]]},b={currencies:["USD","EUR","JPY","GBP","AUD"]};chrome.runtime.onInstalled.addListener(function(a){chrome.storage.local.get(b,function(a){console.log("Existing data",a),chrome.storage.local.set(a,function(){console.log("Updated data.")})})});var y={AED:{name:"United Arab Emirates Dirham",share:null,symbols:["د.إ"],format:"%dد.إ %s",words:["arab","emirates","dirham"]},AFN:{name:"Afghan Afghani",share:null,symbols:["Afs"],format:"%d Afs",words:["afghan","afghani"]},ALL:{name:"Albanian Lek",share:null,symbols:["L"],format:"%d L",words:["albanian","lek"]},AMD:{name:"Armenian Dram",share:null,symbols:["֏"],format:"%d֏",words:["armenian","dram","luma"]},ANG:{name:"Netherlands Antillean Guilder",share:null,symbols:["ƒ","NAƒ"],format:"ƒ%d %s",words:["netherlands","antillean","guilder"]},ANG:{name:"Angolan Kwanza",share:null,symbols:["Kz"],format:"%d kwanzas",words:["angolan","kwanza"]},ARS:{name:"Argentine Peso",share:null,symbols:["$"],format:"$%d %s",words:["argentine","peso"]},AUD:{name:"Australian Dollar",share:6.9,symbols:["$","A$"],format:"$%d %s",words:["australian","dollar"]},AWG:{name:"Aruban Florin",share:null,symbols:["Afl."],format:"Afl. %d",words:["aruban","florin","guilder"]},AZN:{name:"Azerbaijani Manat",share:null,symbols:["₼"],format:"₼%d",words:["azerbaijani","manat"]},BAM:{name:"Bosnia-Herzegovina Convertible Mark",share:null,symbols:["KM"],format:"KM%d",words:["bosnia","herzegovina","convertible","mark"]},BBD:{name:"Barbadian Dollar",share:null,symbols:["Bds$","$"],format:"$%d %s",words:["barbadian","dollar"]},BDT:{name:"Bangladeshi Taka",share:null,symbols:["৳"],format:"৳%d",words:["bangladeshi","taka"]},BGN:{name:"Bulgarian Lev",share:null,symbols:["lv","лв"],format:"%dлв",words:["bulgarian","lev"]},BHD:{name:"Bahraini Dinar",share:null,symbols:[".د.ب","BD"],format:"BD %d",words:["bahraini","dinar"]},BIF:{name:"Burundian Franc",share:null,symbols:["FBu"],format:"FBu %d",words:["burundian","franc"]},BMD:{name:"Bermudian Dollar",share:null,symbols:["BD$","$"],format:"BD$%d %s",words:["bermudian","bermuda","dollar"]},BND:{name:"Brunei Dollar",share:null,symbols:["B$","$"],format:"B$%d %s",words:["brunei","dollar"]},BOB:{name:"Bolivian Boliviano",share:null,symbols:["Bs"],format:"Bs%d",words:["bolivian","boliviano"]},BRL:{name:"Brazilian Real",share:1,symbols:["R$","$"],format:"R$%d %s",words:["brazilian","real","reais"]},BSD:{name:"Bahamian Dollar",share:null,symbols:["B$","$"],format:"B$%d %s",words:["bahamian","dollar"]},BTC:{name:"Bitcoin",share:null,symbols:["₿"],format:"₿%d",words:["bitcoin"]},BTN:{name:"Bhutanese Ngultrum",share:null,symbols:["Nu."],format:"%d Nu.",words:["bhutanese","ngultrum"]},BWP:{name:"Botswanan Pula",share:null,symbols:["P"],format:"P%d",words:["botswana","pula"]},BYN:{name:"New Belarusian Ruble",share:null,symbols:["Br"],format:"Br%d %s",words:["belarusian","ruble"]},BYR:{name:"Belarusian Ruble",share:null,symbols:["Br"],format:"Br%d %s",words:["belarusian","ruble"]},BZD:{name:"Belize Dollar",share:null,symbols:["BZ$"],format:"BZ$%d %s",words:["belize","dollar"]},CAD:{name:"Canadian Dollar",share:5.1,symbols:["C$","Can$","$"],format:"C$%d %s",words:["canadian","dollar"]},CDF:{name:"Congolese Franc",share:null,symbols:["FC"],format:"FC%d",words:["congolese","franc"]},CHF:{name:"Swiss Franc",share:4.8,symbols:["Fr.","SFr."],format:"SFr. %d",words:["swiss","franc"]},CLF:{name:"Chilean Unit of Account",share:null,symbols:["UF"],format:"UF%d",words:["chilean","unidad","fomento"]},CLP:{name:"Chilean Peso",share:null,symbols:["$"],format:"$%d %s",words:["chilean","peso"]},CNY:{name:"Chinese Yuan",share:4,symbols:["¥","元","RMB"],format:"¥%d %s",words:["chinese","yuan","yuán","renminbi","rénmínbì"]},COP:{name:"Colombian Peso",share:null,symbols:["$"],format:"$%d %s",words:["colombian","peso"]},CRC:{name:"Costa Rican Colón",share:null,symbols:["₡"],format:"₡%d",words:["costa","rican","colón"]},CUC:{name:"Cuban Convertible Peso",share:null,symbols:["CUC$","CUC","$"],format:"CUC$%d %s",words:["cuban","peso","dollar","cuc","chavito"]},CUP:{name:"Cuban Peso",share:null,symbols:["₱","$MN","$"],format:"₱%d %s",words:["cuban","peso","dollar"]},CVE:{name:"Cape Verdean Escudo",share:null,symbols:["$"],format:"$%d %s",words:["cape","verdean","escudo"]},CZK:{name:"Czech Koruna",share:null,symbols:["Kč"],format:"%d Kč",words:["czech","koruna","crown"]},DJF:{name:"Djiboutian Franc",share:null,symbols:["Fdj"],format:"%d Fdj",words:["djiboutian","franc"]},DKK:{name:"Danish Krone",share:null,symbols:["kr."],format:"%d kr. %s",words:["danish","krone","kroner"]},DOP:{name:"Dominican Peso",share:null,symbols:["RD$"],format:"RD$%d %s",words:["dominican","peso"]},DZD:{name:"Algerian Dinar",share:null,symbols:["دج","DA"],format:"%d دج",words:["algerian","dinar"]},EGP:{name:"Egyptian Pound",share:null,symbols:["E£","ج.م","L.E.","LE"],format:"E£%d %s",words:["egyptian","pound"]},ERN:{name:"Eritrean Nakfa",share:null,symbols:["Nkf","ናቕፋ","ناكفا"],format:"%d Nkf",words:["eritrean","nakfa"]},EUR:{name:"Euro",share:37.4,symbols:["€"],format:"€%d %s",words:["euro"]},GBP:{name:"British Pound",share:12.8,symbols:["£"],format:"£%d %s",words:["great","british","pound","sterling","quid"]},HKD:{name:"Hong Kong Dollar",share:1.7,symbols:["$","HK$","元"],format:"$%d %s",words:["hong","kong","dollar","港元","Góng yùn"]},HRK:{name:"Croatian Kuna",share:null,symbols:[/kn\b/i],format:"%d kn",words:["croatian","hrvatska","kuna"]},HUF:{name:"Hungarian Forint",share:null,symbols:[/Ft\b/],format:"%d Ft",words:["hungarian","forint"]},IDR:{name:"Indonesian Rupiah",share:null,symbols:["Rp"],format:"Rp %d",words:["indonesian","rupiah","perak"]},ILS:{name:"Israeli New Shekel",share:null,symbols:["₪"],format:"₪%d %s",words:["israeli","shekel","שֶׁקֶל","חָדָשׁ‎","شيقل","جديد","shēqel","jadīd"]},INR:{name:"Indian Rupee",share:1.1,symbols:["₹"],format:"₹%d %s",words:["indian","rupee","rupiya"]},JPY:{name:"Japanese Yen",share:21.6,symbols:["¥","円","圓"],format:"¥%d %s",words:["japanese","yen","円","圓"]},KRW:{name:"South Korean Won",share:1.7,symbols:["₩"],format:"₩%d %s",words:["south","korea","won","원"]},MXN:{name:"Mexican Peso",share:1.9,symbols:["$","Mex$"],format:"$%d %s",words:["mexican","peso"]},MYR:{name:"Malaysian Ringgit",share:null,symbols:["RM"],format:"RM%d",words:["malaysian","ringgit"]},NOK:{name:"Norwegian Krone",share:1.7,symbols:[/kr\b/i],format:"%s %d kr",words:["norwegian","krone"]},NZD:{name:"New Zealand Dollar",share:2.1,symbols:["$"],format:"$%d %s",words:["zealand","dollar","Tāra","Aotearoa","kiwi"]},PHP:{name:"Philippine Peso",share:null,symbols:["₱"],format:"₱%d %s",words:["philippine","peso","piso","pilipinas"]},PLN:{name:"Polish Zloty",share:null,symbols:["zł",/zl\b/i],format:"%dzł",words:["polish","zloty","złoty"]},RON:{name:"Romanian Leu",share:null,symbols:[/leu\b/i],format:"%d lei",words:["romanian","leu","lei"]},RUB:{name:"Russian Ruble",share:1.1,symbols:["₽","руб"],format:"%d₽",words:["russian","ruble","рубль","рубли́"]},SEK:{name:"Swedish Krona",share:2.2,symbols:[/kr\b/i],format:"%s %d kr",words:["swedish","krona","kronor","spänn","pix","daler","riksdaler","crowns","bagare","bagis","lök"]},SGD:{name:"Singapore Dollar",share:1.8,symbols:["$","S$"],format:"S$%d %s",words:["singapore","dollar"]},THB:{name:"Thai Baht",share:null,symbols:["฿"],format:"฿%d %s",words:["thai","baht","บาท"]},TRY:{name:"Turkish Lira",share:1.4,symbols:["₺"],format:"₺%d %s",words:["turkish","lira","Türk","lirası"]},USD:{name:"US Dollar",share:80.6,symbols:["$","US"],format:"$%d %s",words:["united","states","u.s.","american","dollar","buck"]},ZAR:{name:"South African Rand",share:1,symbols:[/R\b/],format:"R %d",words:["south","african","rand"]}};chrome.runtime.onMessage.addListener(function(a,r,n){"get_currencies"===a.id&&n(y)}),chrome.runtime.onMessage.addListener(function(r,n,e){if("detect_data"===r.id){var s=a(r.data);if("string"==typeof s.currency&&"number"==typeof s.value&&0!==s.value)return chrome.storage.local.get("currencies",function(a){var r=[];a.currencies.forEach(function(a){y[a]&&a!==s.currency&&r.push({code:a,name:y[a].name})}),e({title:h(s.currency,d(s.value,3)),value:s.value,currency:s.currency,list:r})}),!0;e(!1)}}),chrome.runtime.onMessage.addListener(function(a,r,n){if("fill_list"===a.id)return s().then(function(r){var e=r.rates[a.base],s=1/e;if("number"!=typeof e)return n({error:"No base rate found"});a.list.forEach(function(n){var e=r.rates[n.code],o=s*e;e&&(n.value=h(n.code,d(o*a.value,3),!1),n.rate=d(o,5))}),n({list:a.list})}),!0})}();